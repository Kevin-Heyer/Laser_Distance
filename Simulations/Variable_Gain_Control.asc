Version 4
SHEET 1 2064 680
WIRE 528 -480 528 -544
WIRE 544 -480 528 -480
WIRE 528 -448 528 -480
WIRE 496 -400 448 -400
WIRE 608 -400 608 -480
WIRE 608 -400 592 -400
WIRE 624 -400 608 -400
WIRE 656 -400 624 -400
WIRE 768 -400 736 -400
WIRE 624 -304 624 -400
WIRE 656 -304 624 -304
WIRE 1648 -304 1568 -304
WIRE 1776 -304 1728 -304
WIRE 768 -288 768 -400
WIRE 768 -288 720 -288
WIRE 960 -288 768 -288
WIRE 656 -272 624 -272
WIRE 512 -240 400 -240
WIRE 624 -240 624 -272
WIRE 624 -240 592 -240
WIRE 1648 -224 1616 -224
WIRE 1792 -224 1712 -224
WIRE 1904 -224 1872 -224
WIRE 400 -176 400 -240
WIRE 1568 -112 1568 -304
WIRE 1680 -112 1568 -112
WIRE 1776 -96 1776 -304
WIRE 1776 -96 1744 -96
WIRE 1792 -96 1776 -96
WIRE 1904 -96 1904 -224
WIRE 1904 -96 1872 -96
WIRE 1920 -96 1904 -96
WIRE 1968 -96 1920 -96
WIRE 1088 -80 1072 -80
WIRE 1232 -80 1152 -80
WIRE 1312 -80 1232 -80
WIRE 1408 -80 1312 -80
WIRE 1568 -80 1568 -112
WIRE 1568 -80 1408 -80
WIRE 1616 -80 1616 -224
WIRE 1680 -80 1616 -80
WIRE 1920 -80 1920 -96
WIRE 1232 -64 1232 -80
WIRE 1312 -64 1312 -80
WIRE 1616 -48 1616 -80
WIRE 1616 -32 1616 -48
WIRE 768 -16 768 -288
WIRE 992 -16 992 -80
WIRE 992 -16 768 -16
WIRE 1232 32 1232 0
WIRE 1312 48 1312 16
WIRE 1408 48 1408 -80
WIRE 1408 48 1312 48
WIRE 1616 64 1616 48
WIRE 1232 160 1232 112
FLAG -112 -256 Vcc
FLAG -112 -176 0
FLAG 32 -176 0
FLAG 32 -256 Vbias
FLAG 688 -256 0
FLAG 688 -320 Vcc
FLAG 448 -400 Vbias
FLAG 960 -288 Vout
FLAG 1232 160 Vbias
FLAG 1968 -96 AGC
FLAG 528 -544 AGC
FLAG 1712 -128 0
FLAG 1312 -80 Rectified
FLAG 400 -96 Vbias
FLAG 1616 -48 SETPOINT
FLAG 624 -400 Vpt-
FLAG 1616 64 0
FLAG 1712 16 0
FLAG 624 -176 0
FLAG 1920 -16 0
SYMBOL voltage -112 -272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=0.2 Cpar=100u
SYMATTR InstName V1
SYMATTR Value {Vcc}
SYMBOL voltage 32 -272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=2m Cpar=100u
SYMATTR InstName V2
SYMATTR Value {Vbias}
SYMBOL voltage 400 -192 R0
WINDOW 123 24 44 Left 2
SYMATTR Value2 AC 10m 0
SYMATTR InstName V3
SYMATTR Value PULSE(0 10m 0 10n 10n 1m 2m)
SYMATTR SpiceLine Rser=1m Cpar=1f
SYMBOL OpAmps\\UniversalOpamp2 688 -288 R0
SYMATTR InstName U1
SYMATTR Value2 Avol=10G GBW=10Meg Slew=10G
SYMATTR SpiceLine Ilimit=25 Rail=0 Vos=0
SYMBOL res 752 -416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 100k
SYMBOL res 608 -256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res 1088 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL schottky 1088 -64 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value B520C
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL cap 1216 -64 R0
SYMATTR InstName C1
SYMATTR Value 100n
SYMBOL OpAmps\\UniversalOpamp2 1712 -96 M180
SYMATTR InstName U3
SYMATTR Value2 Avol=10G GBW=10G Slew=10G
SYMATTR SpiceLine Ilimit=25 Rail=0 Vos=0
SYMBOL res 1888 -112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL res 1296 -80 R0
SYMATTR InstName R7
SYMATTR Value 100
SYMBOL pjf 592 -448 R90
SYMATTR InstName J2
SYMATTR Value PN5116
SYMBOL voltage 1616 -48 R0
WINDOW 123 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value PULSE(0 5 0 {tsim} 10p)
SYMATTR SpiceLine Rser=0.1 Cpar=10u
SYMBOL voltage 1712 -80 R0
WINDOW 123 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 20
SYMATTR SpiceLine Rser=0.1 Cpar=10u
SYMBOL cap 608 -240 R0
SYMATTR InstName C3
SYMATTR Value 10p
SYMBOL cap 1904 -80 R0
SYMATTR InstName C4
SYMATTR Value 10f
SYMBOL res 1744 -320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL cap 1712 -240 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL cap 608 -496 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 100n
SYMBOL res 1888 -240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL res 1216 16 R0
SYMATTR InstName R6
SYMATTR Value 10
TEXT -272 -376 Left 2 !.PARAM Vbias=Vcc/2
TEXT -272 -352 Left 2 !.param Vcc=5
TEXT -128 -104 Left 2 !.tran 0 {tsim} 500u
TEXT -272 -424 Left 2 !.param ts_max=25n
TEXT -272 -400 Left 2 !.param tsim=100m
TEXT 1000 -200 Left 2 ;Rectifier
TEXT 832 -432 Left 2 ;Variable Gain Amplifier
TEXT 1624 -376 Left 2 ;Error Amplifier
TEXT 832 -376 Left 2 ;.step param Rs 10k 100k 20k
TEXT 840 -400 Left 2 ;ABS((V(vpt-)-V(vbias))/I(R1))
TEXT -274 118 Left 2 !;ac dec 10k 1 10Meg
